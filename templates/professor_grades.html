{% extends "base.html" %}
{% block title %}Gradebook{% endblock %}

{% block content %}
  <h2>Gradebook for {{ username }}</h2>

  <form method="get" action="{{ url_for('professor_gradebook') }}">
    <label for="term_id">Term:</label>
    <select name="term_id" id="term_id" onchange="this.form.submit()">
      <option value="">-- select term --</option>
      {% for t in terms %}
        <option value="{{ t.termId }}" {% if t.termId == selected_term %}selected{% endif %}>
          {{ t.termName }}
        </option>
      {% endfor %}
    </select>
    {% if offerings %}
      <label for="offering_id">Course:</label>
      <select name="offering_id" id="offering_id" onchange="this.form.submit()">
        <option value="">-- select course --</option>
        {% for o in offerings %}
          <option value="{{ o.offeringId }}" {% if o.offeringId == selected_offering %}selected{% endif %}>
            {{ o.courseName }}
          </option>
        {% endfor %}
      </select>
    {% endif %}
  </form>

  {% if students %}
    <form method="post" action="{{ url_for('submit_grades') }}">
      <!-- preserve context -->
      <input type="hidden" name="selected_term" value="{{ selected_term }}">
      <input type="hidden" name="selected_offering" value="{{ selected_offering }}">

      <table>
        <thead>
          <tr>
            <th>Student ID</th>
            <th>Name</th>
            <th>Grade (0â€“100)</th>
            <th>Remarks</th>
          </tr>
        </thead>
        <tbody>
          {% for s in students %}
            <tr>
              <td>{{ s.studentId }}</td>
              <td>{{ s.studentName }}</td>
              <td>
                <input type="number" step="0.01" min="0" max="100"
                       name="grade_{{ s.enrollmentId }}"
                       value="{{ s.grade if s.grade is not none }}">
              </td>
              <td>
                <input type="text" name="remarks_{{ s.enrollmentId }}"
                       value="{{ s.remarks or '' }}">
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>

      <button type="submit">Submit Grades</button>
    </form>
  {% endif %}
{% endblock %}
